# An example that forwards log messages to a remote GELF server, while logging them
# locally via the gandelf container's jsonlog driver
# Point your other containers to localhost:12201 with their GELF log driver
version: "2"
services:
  gandelf:
    restart: always
    image: gandelf:2.0.0
    container_name: gandelf
    ports:
      - "12201:12201/udp"
      - "5001:5001"
    logging:
      driver: "json-file"
      options:
        max-size: "5M"
        max-file: "20"
    environment:
      #   - GELF_URL=my-gelf-log-server.com
      - ECHO_LOCAL=true
      - WEBSOCKET_PORT=5001
      - WEBSOCKET_CONSOLE=http://localhost
  ticker:
    restart: always
    image: mhart/alpine-node:12.10.0
    container_name: ticker
    logging:
      driver: gelf
      options:
        # On Mac / Windows
        # gelf-address: "udp://host.docker.internal:12201"
        # On Linux
        # gelf-address: "udp://localhost:12201"
        # Until this PR is merged and released: https://github.com/moby/moby/pull/40007
        gelf-address: "udp://host.docker.internal:12201"
    volumes:
      - ./test:/test
    command: /test/ticker.sh
    depends_on:
      - "gandelf"
    links:
      - gandelf
